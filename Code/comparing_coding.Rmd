---
title: "Comparing Coding"
author: "Emily"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```

```{r}
library(tidyverse)
library(tidytext)
library(ggplot2)
library(here)
library(janitor)

#read in the files
nico_raw_codes <- readxl::read_xlsx(here("Data/nico_coding.xlsx"))
emily_raw_codes <- read_csv(here("Data/emily_first100.csv"))

#function to make the data cleaner and easier to merge together
reorganize_data <- function(d, coder){
  #filter down to the ones we coded and add indicator of who coded what
  d_clean <- d %>% 
            slice(1:100) %>% 
            clean_names()
  
  #long long long 
  d_long <- d_clean %>% 
            pivot_longer(cols = c(becoming, being, neither, both), 
                                   names_to = paste(coder, "code", sep = "_"))
  
  d_long <- replace_na(d_long, list(value = 0))
  d_long <- d_long %>% filter(value == 1)
  
  return(d_long)
}

#apply the function
nico <- reorganize_data(d = nico_raw_codes, coder = "nico")
emily <- reorganize_data(d = emily_raw_codes, coder = "emily")

#other data cleaning stuff
#would like to be able to have this in the function too, 
#but not sure how to set the names of variables nico_unsure and
#emily unsure 

nico <- nico %>% 
        mutate(nico_unsure = unsure) %>% 
        replace_na(replace = list(nico_unsure = 0)) %>% 
        select(-c(unsure, value)) %>% 
        pivot_wider(names_from = )

emily <- emily %>% 
          mutate(emily_unsure = unsure) %>% 
         replace_na(replace = list(emily_unsure = 0)) %>% 
         select(-c(unsure, text, value))

#join them together 
together <- left_join(nico, emily)

together <- together %>% 
            mutate(agree = if_else(nico_code == emily_code, 1, 0))

#we agree more than we disagree :) 
together %>% count(agree)
```

```{r}
#what were our individual distributions of classifications
ggplot(together, mapping = aes(x = nico_code)) + 
      geom_bar() + 
      theme_minimal()

ggplot(together, mapping = aes(x = emily_code)) + 
      geom_bar() + 
      theme_minimal()
```

Types of Agreement: 
```{r}
together <- together %>% 
            mutate(combination = paste("Nico", nico_code, "Emily", emily_code, sep = " "))

ggplot(together, mapping = aes(reorder(combination, agree), 
                               fill = as.factor(agree))) + 
        geom_bar() + theme_minimal() + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
        
```
```{r}
together %>% 
  filter(agree == 0) %>% 
  mutate(unsure = case_when(emily_unsure == 1  & nico_unsure == 0 ~ "Emily Unsure",
                            nico_unsure == 1  & emily_unsure == 0 ~ "Nico Unsure",
                            emily_unsure == 1  & nico_unsure == 1 ~ "Both Unsure",
                            emily_unsure == 0 & nico_unsure == 0 ~ "Neither Unsure")) %>% 
ggplot(mapping = aes(unsure)) + 
        geom_bar() + 
        theme_minimal() + 
        theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))


together %>% 
  filter(agree == 0) %>% 
  mutate(unsure = case_when(emily_unsure == 1  & nico_unsure == 0 ~ "Emily Unsure",
                            nico_unsure == 1  & emily_unsure == 0 ~ "Nico Unsure",
                            emily_unsure == 1  & nico_unsure == 1 ~ "Both Unsure",
                            emily_unsure == 0 & nico_unsure == 0 ~ "Neither Unsure")) %>% 
ggplot(mapping = aes(combination)) + 
        geom_bar() + 
        facet_wrap(~unsure) + 
        theme_minimal() + 
        theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

Table of All our Disagreements
```{r}
ids <- together %>% 
       filter(agree == 0)

disagree_table <- together %>% 
                  filter(agree == 0) %>% 
                  select(text, combination, emily_unsure, nico_unsure)

library(DT)
datatable(disagree_table)
```

